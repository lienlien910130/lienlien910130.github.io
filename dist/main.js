(()=>{"use strict";window.addEventListener("load",(()=>{let e,t,n;liff.init({liffId:"1660857311-QDo3BLk3",withLoginOnExternalBrowser:!0}).then((()=>{let u,p;u=liff.isInClient(),p=liff.isLoggedIn(),liff.getProfile().then((l=>{e=l.userId,t=l.displayName,n=l.pictureUrl,m()})),o.addEventListener("click",(()=>{m()})),c.addEventListener("click",(()=>{p&&liff.scanCode?(l.style.display="none",c.style.display="none",o.style.display="none",liff.scanCodeV2().then((t=>{console.log(t.value);var n=t.value;Object.assign(n,{line_uid:e}),fetch("/forum23/api/rsvp/qr-verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((e=>e.json())).then((e=>{if(console.log(e),1==e.success){if(i.innerHTML=t.value.passcode,a.innerHTML=e.data.name,!1!==e.data.checked){var n=new Date(1e3*e.data.checked),l=n.getHours(),c="0"+n.getMinutes();s.innerHTML="已於 "+l+":"+c+" 由"+e.data.checker_name+"審核入場",s.style.display="block"}else r.style.display="block",r.addEventListener("click",(()=>{fetch("/forum23/api/rsvp/check-in",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.value)}).then((e=>e.json())).then((e=>{1==e.success||alert("驗證錯誤"),y()})).catch((e=>{alert("驗證錯誤"),y()}))}));d.style.display="block"}else alert("QR 無效"),y()})).catch((e=>{alert("QR 無效"),y()}))})).catch((e=>{alert("liff error")}))):alert("請先登入Line")}))})).catch((e=>{console.log(e)})),document.getElementById("header"),document.getElementById("pic"),document.getElementById("name"),document.getElementById("currentNum"),document.getElementById("totalNum");const l=document.getElementById("btns"),c=document.getElementById("qrScan"),o=document.getElementById("againcheck"),d=document.getElementById("textDiv"),i=document.getElementById("code"),a=document.getElementById("currentName"),s=document.getElementById("passed"),r=document.getElementById("passbtn");function m(){fetch("https://mm-jp4.aws.macromicro.me/forum23/api/checker",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({line_uid:e,display_name:t,picture_url:n})}).then((e=>e.json())).then((e=>{console.log(e)})).catch((e=>{console.log("錯誤:",e)}))}function y(){i.innerHTML="",a.innerHTML="",r.style.display="none",s.style.display="none",d.style.display="none",l.style.display="block"}document.getElementById("cancelbtn").addEventListener("click",(()=>{y()}))}))})();