(()=>{"use strict";var e="https://mm-jp4.aws.macromicro.me";window.addEventListener("load",(()=>{let t,n,s;liff.init({liffId:"1660857311-QDo3BLk3",withLoginOnExternalBrowser:!0}).then((()=>{let l,c;l=liff.isInClient(),c=liff.isLoggedIn(),liff.getProfile().then((e=>{t=e.userId,n=e.displayName,s=e.pictureUrl,E()})),y.addEventListener("click",(()=>{E()})),r.addEventListener("click",(()=>{if(c){d.style.display="none",r.style.display="none",y.style.display="none";var n=!1;liff.scanCodeV2().then((e=>{JSON.parse(e.value).line_uid=t,n=!0})).catch((e=>{n=!1})),n?(s=obj,fetch(e+"/forum23/api/rsvp/qr-verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then((e=>e.json())).then((t=>{if(1==t.success){if(m.innerHTML=s.passcode,u.innerHTML=t.data.name,null!==t.data.checked){var n=new Date(1e3*t.data.checked),l=n.getHours(),c=n.getMinutes();h.innerHTML="已於 "+l+":"+c+" 由"+t.data.checker_name+"審核入場",h.style.display="block"}else f.style.display="block",f.addEventListener("click",(()=>{!function(t){fetch(e+"/forum23/api/rsvp/check-in",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>e.json())).then((e=>{1==e.success?(I(),k()):(alert("驗證錯誤:"+JSON.stringify(e)),I())})).catch((e=>{alert(e),I()}))}(s)}));p.style.display="block"}else alert("QRcode無效"),I()})).catch((e=>{alert("QRcode無效"),I()}))):(alert("QRcode無效"),I())}else alert("請由 Line App 打開");var s}))})).catch((e=>{console.log(e)}));const l=document.getElementById("header"),c=document.getElementById("pic"),a=document.getElementById("name"),i=document.getElementById("currentNum"),o=document.getElementById("totalNum"),d=document.getElementById("btns"),r=document.getElementById("qrScan"),y=document.getElementById("againcheck"),p=document.getElementById("textDiv"),m=document.getElementById("code"),u=document.getElementById("currentName"),h=document.getElementById("passed"),f=document.getElementById("passbtn"),g=document.getElementById("cancelbtn");function E(){fetch(e+"/forum23/api/rsvp/checker",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({line_uid:t,display_name:n,picture_url:s})}).then((e=>e.json())).then((e=>{d.style.display="block",r.style.display="none",y.style.display="none",1==e.success?(k(),l.style.display="flex",c.src=s,a.innerHTML=n,r.style.display="block"):0==e.success&&401==e.error?y.style.display="block":alert("審核不通過")})).catch((e=>{console.log("錯誤:",e)}))}function k(){fetch(e+"/forum23/api/rsvp/stats",{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{console.log("stats",e),e.success&&(i.innerHTML=e.cnt_checked,o.innerHTML=e.cnt,i.animate([{transform:"translate(1px, 1px)",fontSize:"24px"}],{duration:750}))})).catch((e=>{alert(e)}))}function I(){m.innerHTML="",u.innerHTML="",f.style.display="none",h.style.display="none",p.style.display="none",d.style.display="block",r.style.display="block"}c.addEventListener("click",(()=>{window.location.reload()})),g.addEventListener("click",(()=>{I()}))}))})();